Banner: |

  | This is a simple policy file with just two main rules with 5 patterns to scan and report to
  | Use this banner to post guidelines and ocumentation about this pipeline step

  Rss

Rules:
  - name: Private key committed in code
    id: 001
    description: Private key inside code version control
    solution: Remove it, rewrite git history and use Vault or AWS Sectets Manager to secure your private keys
    error: This violation immediatly blocks your code deployment
    type: scan
    enforcement: true
    environment:
    fatal: true
    patterns:
      - \s*(-----BEGIN PRIVATE KEY-----)
      - \s*(-----BEGIN RSA PRIVATE KEY-----)
      - \s*(-----BEGIN DSA PRIVATE KEY-----)
      - \s*(-----BEGIN EC PRIVATE KEY-----)
      - \s*(-----BEGIN OPENSSH PRIVATE KEY-----)
      - \s*(-----BEGIN PGP PRIVATE KEY BLOCK-----)

  - name: Module not sourced from artifactory
    id: 005
    description: In production environment modules should be sourced from artifactory and not locally nor from git
    error: This violation will block your code promotion to production environments
    type: scan
    solution: "\n\tSource your modules from their latest version on artifactory \n\tMore info at XXX"
    environment: prod
    fatal: true
    enforcement:
    patterns:
      - source\s*.*\.git"
      - \s+source\s*=\s*"((?!https\:).)

  - name: Collect TF resources outside of modules.
    description: Since we only authorize TF modules to be deployed we collect TF Resources to be validated
    type: collect
    patterns:
      - (resource)\s*"(.*)"
